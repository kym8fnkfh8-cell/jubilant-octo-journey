<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>OSRS Skilling Planner â€” v4.3f</title>
<meta name="theme-color" content="#0b0d12" />
<link rel="manifest" href="manifest.webmanifest">
<link rel="icon" href="favicon.png">
<link rel="apple-touch-icon" href="icon-192.png">
<style>
:root{--bg:#0b0d12;--stone:#141824;--stone2:#0f1320;--edge:#2a2f45;--text:#f0f3f9;--muted:#9aa3b2;--gold:#e6c36a;--accent:#8ab4f8}
body{margin:0;padding:0;background:var(--bg);color:var(--text);font:16px/1.45 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu}
.wrap{max-width:1040px;margin:18px auto 80px;padding:0 14px}
header{display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:12px}
h1{font-size:20px;color:var(--gold);margin:0;text-shadow:0 1px 0 #433,0 0 6px rgba(230,195,106,.15)}
.card{background:linear-gradient(180deg,var(--stone),var(--stone2));border:1px solid var(--edge);border-radius:12px;padding:14px;box-shadow:0 8px 24px rgba(0,0,0,.35)}
.grid{display:grid;grid-template-columns:repeat(12,1fr);gap:12px}
.span-3{grid-column:span 3}.span-4{grid-column:span 4}.span-6{grid-column:span 6}.span-12{grid-column:1/-1}
label{display:block;font-size:12px;color:var(--muted);margin-bottom:6px}
input,select{width:100%;background:#0c1019;border:1px solid #2a2f45;color:var(--text);padding:10px 12px;border-radius:9px}
.btn{border:1px solid #463a1a;background:linear-gradient(180deg,#e6c36a,#caa64f);color:#1a1208;padding:10px 14px;border-radius:10px;cursor:pointer;font-weight:700}
.btn:hover{filter:brightness(1.05)}.btn.outline{background:transparent;color:var(--gold);border-color:#5a4a1f}
.pill{display:inline-flex;align-items:center;gap:8px;padding:6px 10px;border-radius:999px;border:1px solid #2a2f45;background:#111522;font-size:12px;color:var(--muted)}
.kpi{display:flex;flex-direction:column;gap:4px;padding:10px 12px;border-radius:10px;background:#0e1220;border:1px solid #23283a}
.kpi .big{font-weight:800;font-size:22px;color:var(--gold)}
.progress{height:12px;border-radius:999px;border:1px solid #2a2f45;background:#0d111b;overflow:hidden}
.progress>div{height:100%;width:0;background:linear-gradient(90deg,#24c8a8,#5fb3ff)}
.week-wrap{overflow-x:auto;padding-bottom:6px}
.week{display:grid;gap:12px;grid-template-columns:repeat(auto-fill,minmax(150px,1fr))}
.day{background:#0f1320;border:1px solid #23283a;border-radius:10px;padding:10px}
.day h4{margin:0 0 6px;font-size:13px;color:#c2c9d6}
input[type=range]{width:100%;background:transparent}
.footer{text-align:center;font-size:12px;color:#98a1b3;margin:30px 0 10px}
.skill-picker{position:relative}
.skill-btn{width:100%;display:flex;align-items:center;gap:10px;padding:10px 12px;border:1px solid #2a2f45;border-radius:9px;background:#0c1019;color:var(--text);cursor:pointer}
.skill-btn img{width:22px;height:22px;border-radius:4px}
.skill-panel{position:absolute;z-index:50;left:0;width:min(620px,96vw);margin-top:6px;background:#0f1320;border:1px solid #23283a;border-radius:10px;box-shadow:0 10px 30px rgba(0,0,0,.4);display:none;max-height:70vh;overflow-y:auto;padding:12px}
.skill-grid{display:grid;gap:10px;grid-template-columns:repeat(auto-fill,minmax(180px,1fr))}
.skill-item{display:flex;align-items:center;gap:8px;padding:8px;border:1px solid #23283a;border-radius:8px;background:#0e1220;cursor:pointer}
.skill-item:hover{background:#10162a}
#splash{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:#0b0d12;z-index:999}
.fade-out{animation:fadeout .45s ease forwards}@keyframes fadeout{to{opacity:0;transform:translateY(6px)}}
</style>
</head>
<body>
<div id="splash"><h1 style="color:var(--gold)">Loadingâ€¦</h1></div>

<div class="wrap" id="appRoot" style="visibility:hidden">
<header>
 <h1>OSRS Skilling Planner <small>v4.3f</small></h1>
 <button id="addWeekBtn" class="btn">+ Add Week</button>
</header>

<div class="card grid">
 <div class="span-4"><label>RuneScape name</label><input id="rsn" type="text" value="D 3VI L"></div>
 <div class="span-4"><label>Hiscore type</label>
   <select id="mode">
     <option value="hiscore_oldschool">Normal</option>
     <option value="hiscore_oldschool_ironman">Ironman</option>
     <option value="hiscore_oldschool_ultimate">Ultimate</option>
     <option value="hiscore_oldschool_hardcore_ironman">Hardcore</option>
   </select>
 </div>
 <div class="span-4"><label>&nbsp;</label><button id="fetchBtn" class="btn">Fetch Hiscores</button></div>

 <div class="span-12 card">
  <div class="pill">ðŸŽ¯ Goal setup</div>
  <div class="grid" style="margin-top:10px">
   <div class="span-4">
    <label>Skill</label>
    <div class="skill-picker">
     <button type="button" id="skillBtn" class="skill-btn"><img id="skillIcon" src="assets/skills/fishing.png"><span id="skillLabel">Fishing</span></button>
     <div class="skill-panel" id="skillPanel"></div>
    </div>
   </div>
   <div class="span-4"><label>Target level</label><select id="targetLevel"></select></div>
   <div class="span-4"><label>XP/hr</label><input id="xpPerHour" type="number" value="90000"></div>
  </div>
 </div>
</div>

<div id="weeks"></div>

<footer class="footer">
 Old School RuneScape assets Â© Jagex Ltd â€” used under Jagexâ€™s <a href="https://www.jagex.com/en-GB/terms/fan-content-policy" target="_blank">Fan Content Policy</a>.
</footer>
</div>

<script>
(function(){
const XP=[];let pts=0;for(let L=1;L<=126;L++){pts+=Math.floor(L+300*Math.pow(2,L/7));XP[L]=Math.floor(pts/4)}
const SK=[{k:"attack"},{k:"defence"},{k:"strength"},{k:"hitpoints"},{k:"ranged"},{k:"prayer"},{k:"magic"},{k:"cooking"},{k:"woodcutting"},{k:"fletching"},{k:"fishing"},{k:"firemaking"},{k:"crafting"},{k:"smithing"},{k:"mining"},{k:"herblore"},{k:"agility"},{k:"thieving"},{k:"slayer"},{k:"farming"},{k:"runecraft"},{k:"hunter"},{k:"construction"}];
const root=document.getElementById("appRoot");const splash=document.getElementById("splash");
function hideSplash(){splash.classList.add("fade-out");setTimeout(()=>splash.remove(),600);root.style.visibility="visible";}
window.addEventListener("load",hideSplash);
const tSel=document.getElementById("targetLevel");for(let L=1;L<=126;L++){let o=document.createElement("option");o.value=L;o.textContent=L;tSel.appendChild(o)}
const skillBtn=document.getElementById("skillBtn"),skillPanel=document.getElementById("skillPanel"),skillIcon=document.getElementById("skillIcon"),skillLabel=document.getElementById("skillLabel");
SK.forEach(s=>{let d=document.createElement("div");d.className="skill-item";let i=document.createElement("img");i.src="assets/skills/"+s.k+".png";i.alt=s.k;let sp=document.createElement("span");sp.textContent=s.k[0].toUpperCase()+s.k.slice(1);d.append(i,sp);d.onclick=()=>{skillIcon.src=i.src;skillLabel.textContent=sp.textContent;skillPanel.style.display="none"};skillPanel.appendChild(d)});
skillBtn.onclick=()=>skillPanel.style.display=skillPanel.style.display==="block"?"none":"block";
window.onclick=e=>{if(!skillPanel.contains(e.target)&&e.target!==skillBtn)skillPanel.style.display="none"}
document.getElementById("fetchBtn").onclick=async()=>{
 const rsn=document.getElementById("rsn").value.trim();if(!rsn)return alert("Enter RSN first");
 const mode=document.getElementById("mode").value;
 const url=`https://api.allorigins.win/raw?url=${encodeURIComponent("https://secure.runescape.com/m="+mode+"/index_lite.ws?player="+encodeURIComponent(rsn))}`;
 try{
  const res=await fetch(url);const txt=await res.text();
  const lines=txt.trim().split(/\r?\n/);const data=lines.map(l=>l.split(","));
  const idx=SK.findIndex(s=>s.k===skillLabel.textContent.toLowerCase());
  const lvl=data[idx+1]?+data[idx+1][1]:1;const xp=data[idx+1]?+data[idx+1][2]:0;
  alert(`Fetched: level ${lvl} â€” ${xp.toLocaleString()} XP`);
 }catch(e){alert("Hiscore fetch failed: "+e.message)}
};
})();
</script>
<script>
if('serviceWorker' in navigator && !location.search.includes('no-sw=1')){
 window.addEventListener('load',()=>navigator.serviceWorker.register('./service-worker.js').catch(()=>{}));
}
</script>
</body>
</html>
